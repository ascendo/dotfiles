# Example prompt:
#
# 23:11:27 | 3s | (1) | %0 | !5232
# user@host:/tmp
# $

timer_start () { : ${timer=$SECONDS}; }

timer_stop  () {
    RUNTIME=$(($SECONDS - $timer))
    unset timer

    # Convert seconds to hms.
    RUNTIME_FORMATTED=
    [[ $RUNTIME -gt 3600 ]] && RUNTIME_FORMATTED+=$(($RUNTIME / 3600))h
    [[ $RUNTIME -gt 60 ]]   && RUNTIME_FORMATTED+=$(($RUNTIME % 3600 / 60))m
    [[ $RUNTIME -gt 0 ]]    && RUNTIME_FORMATTED+=$(($RUNTIME % 60))s
    : ${RUNTIME_FORMATTED:=0s}
}

trap 'timer_start' DEBUG
PROMPT_COMMAND='get_exit_status; '$PROMPT_COMMAND' timer_stop;'

get_exit_status () {
    EXIT_STATUS=$?
    if [[ 0 -eq $EXIT_STATUS ]]; then
        EXIT_STATUS_COLOR=${ANSI_BOLD}${ANSI_GREEN}
    else
        EXIT_STATUS_COLOR=${ANSI_BOLD}${ANSI_RED}
    fi
}

PS1='\[${ANSI_RESET}\]'

# Set the terminal title.
PS1=$PS1'\[\e]0;\w\a\]'

PS1=$PS1'\n\t | ${RUNTIME_FORMATTED} | (${SHLVL}) | %\j | !\!'
PS1=$PS1'\n\u@\h:\[${ANSI_CYAN}\]\w\[${ANSI_RESET}\]'
PS1=$PS1'\n\[${EXIT_STATUS_COLOR}\]\$\[${ANSI_RESET}\] '
export PS1
